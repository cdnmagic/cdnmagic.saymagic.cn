function FVoteListCtrl($scope,FVote){$scope.fvotes=FVote.query()}function FVoteItemCtrl($scope,$routeParams,socket,FVote){$scope.fvote=FVote.get({fvoteId:$routeParams.fvoteId});socket.on("myvote",function(data){console.dir(data);if(data._id===$routeParams.fvoteId){$scope.fvote=data}});socket.on("vote",function(data){console.dir(data);if(data._id===$routeParams.fvoteId){$scope.fvote.choices=data.choices;$scope.fvote.totalVotes=data.totalVotes}});$scope.vote=function(){var fvoteId=$scope.fvote._id,choiceId=$scope.fvote.userVote;if(choiceId){var voteObj={fvote_id:fvoteId,choice:choiceId};socket.emit("send:vote",voteObj)}}}function FVoteNewCtrl($scope,$location,FVote){$scope.fvote={question:"",choices:[{text:""},{text:""},{text:""}]};$scope.addChoice=function(){$scope.fvote.choices.push({text:""})};$scope.newVote=function(){var fvote=$scope.fvote;if(fvote.question.length>0){var choiceCount=0;for(var i=0,ln=fvote.choices.length;i<ln;i++){var choice=fvote.choices[i];if(choice.text.length>0){choiceCount++}}if(choiceCount>1){var newFVote=new FVote(fvote);newFVote.$save(function(p,resp){if(!p.error){$location.path("fvotes")}else{alert("创建失败")}})}else{alert("选项少于两个，创建失败。")}}else{alert("主题无效")}}};
